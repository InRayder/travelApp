# 更新日誌 (Changelog)

## [0.2.0] - 2025-12-11

### 🎬 新增主要功能 (Major Features)
- **Vlog 拍攝腳本生成**: 新增 Vlog 拍攝腳本頁面，整合 AI 自動生成逐天拍攝清單、文案與鏡頭建議，協助規劃視頻內容。
- **AI 相機工具**: 全新沉浸式相機介面，支援：
  - 即時姿態檢測（用於自拍引導框）
  - 三分構圖網格與交點提示
  - 前後鏡頭切換
  - 風景/人像自動模式切換
  - 實時水平儀與對焦指示
  - 虛擬背景與濾鏡（預留擴展）
  - 照片與影片錄製
- **導覽列重組**: 底部導覽從單列改為「更多」菜單，整合清單、對話、Vlog、AI 相機與設定功能。

### 🎨 介面與使用體驗 (UI/UX)
- **Action Sheet 風格菜單**: 「更多」按鈕展開底部滑出選單，支援 iOS/Android 原生風格體驗。
- **選單動畫**: 新增漸變遮罩與彈簧動畫，提升交互質感。
- **自動導覽隱藏**: AI 相機頁面時自動隱藏底部導覽列，提供全屏沉浸式體驗。
- **Header 簡化**: 移除 Header 中的設定按鈕，統一由「更多」菜單提供。

### 📦 依賴更新 (Dependencies)
- **新增**: `@mediapipe/tasks-vision` - 用於實時姿態檢測與物體識別。

## [0.1.6] - 2025-12-07

### 新增功能 (New Features)
- **刪除天數功能**: 在日期選擇器中新增刪除天數按鈕，可快速移除不需要的天數，該天的行程會自動移至備案。
- **AI 行程生成引導**: 空白行程頁面新增 AI 行程生成按鈕，引導使用者使用 AI 功能快速建立行程。
- **日期自動重算**: 刪除天數後會自動重新計算所有日期字串，保持日期連續性。

### 使用體驗優化 (UX Improvements)
- **AI 助手狀態管理**: 將 AI 助手開關狀態移至 Store 統一管理 (`isAiAssistantOpen`)，避免多處重複宣告。
- **空白頁面引導**: 無行程時顯示 AI 生成行程按鈕，未設定 API Key 則顯示設定提示連結。
- **刪除確認對話框**: 刪除天數前會顯示確認訊息，並告知該天有多少個行程將移至備案。
- **視覺回饋**: 日期卡片 hover 時顯示刪除按鈕，提升操作直覺性（至少保留一天）。

### 修正項目 (Fixed)
- **移除冗餘狀態**: 清理 `App.vue` 中的 `aiAssistantOpen` 本地狀態，統一使用 Store 管理。

## [0.1.5] - 2025-12-07

### 程式碼重構 (Refactoring)
- **類型定義模組化**: 將所有介面定義 (`Guide`, `Event`, `Transport`, `Expense` 等) 抽離至獨立的 `types.ts` 檔案，提升程式碼可維護性。
- **預設資料分離**: 將範例行程 (`EXAMPLE_TRIP`) 與預設攻略 (`DEFAULT_GUIDES`) 移至 `data/` 目錄，結構更清晰。
- **Store Actions 封裝**: 新增 CRUD 封裝方法：
  - **備案操作**: `addBackup`, `removeBackup`, `updateBackup`, `promoteBackupToEvent`
  - **事件操作**: `insertEvent`, `removeEvent`, `moveEventToBackup`
  - **支出操作**: `addExpenseRecord`, `updateExpenseAt`, `removeExpense`
  - **攻略操作**: `deleteGuide`
  - **資料匯入**: `importData`

### 程式碼改善 (Code Improvements)
- **統一確認視窗邏輯**: 新增 `useConfirmModal` composable，統一管理確認對話框與提示訊息。
- **View 層簡化**: `ItineraryView` 與 `AccountingView` 改用封裝的 Store actions，移除直接操作 state 的程式碼。
- **資料操作安全性**: 所有 CRUD 操作確保自動生成 UUID、自動排序、自動驗證衝突。

### 功能優化 (Enhancements)
- **清除資料保留 API Key**: 清除行程資料時會保留使用者的 Gemini API Key 設定。
- **資料匯入增強**: `importData` 方法加入資料清理與驗證，確保匯入的資料格式正確。

### 開發體驗 (Developer Experience)
- **iOS 觸控優化**: 修正 iOS Safari 上按鈕點擊問題，加入 `touch-action` 與 `z-index` 調整。
- **Vite 開發伺服器**: 開啟 `host: true` 設定，支援手機等外部裝置透過區域網路訪問開發伺服器。

## [0.1.4] - 2025-12-05

### 主要功能 (Major Features)
- **旅遊攻略卡片重構**: 全新的卡片式設計，展示來源平台、地點、評分、標籤與用戶筆記，提供更豐富的資訊視覺化。
- **攻略狀態管理**: 新增「想去」、「已排程」、「已去過」三種狀態切換，方便追蹤景點進度。
- **一鍵加入行程**: 攻略卡片可直接加入行程，自動帶入地點、描述等資訊，並自動更新攻略狀態。
- **行程時間衝突檢測**: 自動檢測交通與活動的時間衝突，以紅色框線標示衝突事件，避免行程安排錯誤。

### 資料結構優化 (Data Structure)
- **Guide 介面擴充**: 新增 `id`、`media_type`、`location`、`user_notes`、`status`、`thumbnail_url` 等欄位，支援更完整的攻略資訊。
- **Event 介面優化**: 統一事件資料結構，新增 `id`、`bookingLink`、`stayInfo`、`ticketLink` 等欄位。
- **Transport 整合**: 交通資訊整合至事件中，新增 `duration` 與 `passId` 欄位，支援票券關聯。
- **Expense 介面簡化**: 統一支出欄位命名，改善資料一致性。

### 介面優化 (UI Improvements)
- **攻略卡片**: 從雙欄網格改為單欄卡片式設計（桌面版雙欄），顯示更多資訊細節。
- **來源標示**: 卡片右上角顯示來源平台圖示（Instagram、YouTube、網頁）。
- **快速操作**: 卡片底部新增狀態切換、加入行程、原始連結、導航等快捷按鈕。
- **衝突警示**: 時間衝突的事件以紅色框線標示，提升可視性。

### 修正項目 (Fixed)
- **資料遷移**: 自動將舊版 `link` 欄位遷移至 `original_url`，`image` 遷移至 `thumbnail_url`。
- **事件排序**: 確保所有事件按時間自動排序，載入時也會重新排序。
- **記帳邏輯**: 修正支出分帳計算中可能的空值錯誤。
- **Store 方法**: 新增 `updateEvent`、`updateGuide`、`validateConflicts` 等方法，提升程式碼可維護性。

## [0.1.3] - 2025-12-03

### 主要功能 (Major Features)
- **準備清單頁面 (Checklist)**: 新增旅程準備清單功能,內建「行前準備」與「退房前準備」兩大分類,使用者可自行新增類別與項目。
- **AI 智能匯入攻略 (AI Import Guide)**: 新增從社群媒體 (Instagram/Facebook) 貼文連結或內容自動生成旅遊攻略卡片的功能,AI 會自動分析景點資訊、必看重點與參觀撇步。
- **PWA 分享目標 (Share Target)**: 應用程式現在支援作為分享目標,使用者可直接從其他 App 分享內容至 Easy Trip,並自動開啟 AI 智能匯入功能。

### 其他新增 (Other Additions)
- **新增 InputModal 元件**: 通用的輸入對話框元件,用於快速輸入文字 (如新增清單分類名稱)。
- **新增 aiService**: 抽離 AI 生成攻略的邏輯至獨立的 service 檔案,提升程式碼可維護性。
- **路由守衛 (Route Guard)**: 新增路由守衛功能,自動偵測分享目標參數並導向攻略頁面。
- **PWA 安裝提示優化**: 改善安裝提示邏輯,將 `beforeinstallprompt` 事件儲存至 Pinia store,並整合至新手導覽 (Onboarding) 中。
- **AI 模型升級**: 預設 AI 模型從 `gemini-1.5-flash` 升級至 `gemini-2.5-flash`,提供更快速與精準的回應。

### 介面優化 (UI Improvements)
- **底部導覽列**: 新增「準備清單」導覽按鈕,並調整原有按鈕配置。
- **新手導覽 (Onboarding)**: 新增第五個投影片,專門引導使用者安裝 PWA 應用程式。
- **安裝提示**: 只在新手導覽關閉後才顯示安裝提示,避免重複干擾。
- **記帳頁面 FAB 調整**: 將新增費用按鈕位置下移,避免與底部導覽列重疊。

### 修正項目 (Fixed)
- **事件監聽器管理**: 在 `App.vue` 中正確新增與移除 `beforeinstallprompt` 事件監聽器,避免記憶體洩漏。
- **InstallPrompt 元件重構**: 將安裝提示事件管理移至 Pinia store,簡化元件邏輯。

## [0.1.2] - 2025-12-02

### 主要功能 (Major Features)
- **AI 智慧助手 (AI Assistant)**: 全新 AI 助手登場！不僅支援極速翻譯與情境模擬對話，更能協助生成旅遊攻略、推薦交通方式，甚至與您討論行程安排，是您日本之旅的全能夥伴。
- **實用日語對話 (Practical Japanese Conversation)**: 整合了自訂對話編輯、語音朗讀 (TTS) 及極速翻譯功能，打造更實用的溝通工具。

### 其他新增 (Other Additions)
- **極速翻譯 (Fast Translation)**: 翻譯功能自動切換至 `Gemini 2.5 Flash-Lite` 模型，回應更迅速。
- **Google 翻譯備援 (Google Translate Fallback)**: 若未設定 API Key，自動開啟 Google 翻譯網頁作為備援。
- **介面優化 (UI Improvements)**: 根據 API Key 設定狀態自動調整介面顯示。

### 修正項目 (Fixed)
- **Pinia 持久化 (Pinia Persistence)**: 修正了 `conversations` store 中因缺少 `pinia-plugin-persistedstate` 導致的 TypeScript 錯誤，確保資料能正確儲存。

## [0.1.1] - 2025-12-01

### 新增功能 (Added)
- **設定頁面優化 (Settings)**: 重構設定視窗為分頁式設計 (行程、偏好、票券、系統)，提升操作體驗。
- **語音選擇 (Voice Selection)**: 在日語對話功能中新增語音選擇與試聽功能，支援瀏覽器提供的多種日語語音。
- **效能監控 (Speed Insights)**: 整合 Vercel Speed Insights 以監控應用程式效能。

## [0.1.0] - 2025-11-30

### 新增功能 (Added)
- **標題列自動收合**: 實作了動態標題列，當向下捲動時會自動縮小以最大化瀏覽空間。此功能已套用於行程、攻略及記帳頁面。
- **地圖檢視整合**: 將地圖頁籤整合至行程頁籤中。使用者現在可以在行程頁面內直接切換「列表」與「地圖」模式。
- **票券顯示功能**: 在交通詳情視窗中新增了「查看票券」按鈕（票券圖示），方便快速查看關聯的交通票券。
- **亮度自動增強**: 查看票券圖片時新增了自動亮度增強功能，確保圖片清晰可讀。
- **匯率設定**: 在設定頁面新增「匯率設定」功能，允許使用者手動調整新台幣 (TWD) 對日圓 (JPY) 的匯率，並即時反映於費用計算。
- **AI 助手互動模式**: 更新 AI 指令，新增「逐日確認」與「概略確認」兩種互動模式，讓使用者能選擇行程確認的詳細程度。
- **PWA 安裝提示**: 新增自動偵測並詢問使用者是否安裝應用程式的功能。
  - **Android / Desktop**: 自動顯示安裝提示。
  - **iOS**: 顯示專屬教學視窗，引導使用者透過「加入主畫面」進行安裝。

### 變更項目 (Changed)
- **底部導覽列**: 改善了底部導覽列未選取圖示的對比度（從 `text-gray-300` 改為 `text-gray-400`），提升可視性。
- **介面優化**: 將「查看票券」功能從編輯事件視窗移動至交通詳情視窗，以符合使用情境。
- **幣別管理**: 將幣別資料從 getter 移至 state 管理，並簡化系統僅保留 TWD 與 JPY 兩種幣別。
- **AI 指令優化**:
  - 明確定義 `Transport` 介面中的 `flight` 類型及相關欄位。
  - 明確列出所有可用的 Tailwind CSS 顏色與色階，防止生成錯誤的顏色代碼。
  - 補充說明 `company` 欄位包含航空公司資訊。

### 移除項目 (Removed)
- **天氣資訊**: 移除了行程頁面日期選擇器中的靜態天氣圖示與溫度顯示，因目前無法同步即時天氣資訊。
- **地圖頁籤**: 移除了底部導覽列中獨立的地圖頁籤，改用整合式的切換開關。

### 修正項目 (Fixed)
- **型別安全**: 解決了與 `SortableJS`、`Leaflet` 及 `Event` 型別相關的 TypeScript 錯誤。
- **匯率顯示**: 修正設定頁面中匯率輸入框因 Vue 渲染優先順序導致無法顯示的問題。
